# =======================================================
# 1. РЕЖИМ РАБОТЫ (ПЕРЕКЛЮЧАТЕЛЬ LOCAL / PROD)
# =======================================================
# Этот блок управляет CORS и безопасностью Cookies.
# Выберите ОДИН вариант.

# --- [A] LOCALHOST (Разработка) ---
# Используйте этот режим, если запускаете проект локально.
APP_ENV=development
APP_PORT=5580
COOKIE_SECURE=False
# Для localhost домен куки должен быть пустым
SESSION_COOKIE_DOMAIN=
# Разрешаем запросы с локального React (обычно порт 3000) и Swagger/API (5580)
CLIENT_ORIGINS=http://localhost:5580,http://127.0.0.1:5580,http://localhost:3000,http://127.0.0.1:3000

# --- [B] PRODUCTION (botplus.ru) ---
# Раскомментировано для деплоя на сервер.
# APP_ENV=production
# APP_PORT=5580
# ВНИМАНИЕ: Если сайт пока работает по http://, временно поставьте COOKIE_SECURE=False
# COOKIE_SECURE=True
# SESSION_COOKIE_DOMAIN=.botplus.ru
# Добавлен http://botplus.ru на случай работы без SSL
# CLIENT_ORIGINS=https://botplus.ru,https://api.botplus.ru,http://botplus.ru


# =======================================================
# 2. БЕЗОПАСНОСТЬ (Flask & Auth)
# =======================================================
# ОБЯЗАТЕЛЬНО: Придумайте и впишите сюда случайные длинные строки перед деплоем!
SECRET_KEY=change-me-to-super-secret-key-replace-in-prod
JWT_SECRET=another-super-secret-key-for-jwt
# 7 дней жизни токена (используется в AuthContext.tsx через API)
ACCESS_TOKEN_EXPIRES_SECONDS=604800
# Lax позволяет кукам работать при навигации, но блокирует в iframe (безопасно)
COOKIE_SAMESITE=Lax


# =======================================================
# 3. АДМИНИСТРАТОР (Автосоздание)
# =======================================================
# Создается при старте контейнера, если таблица users пуста
DEFAULT_ADMIN_USERNAME=admin
DEFAULT_ADMIN_PASSWORD=change_me_please

# (Опционально) Дефолтный обычный пользователь
DEFAULT_USER_USERNAME=user
DEFAULT_USER_PASSWORD=password


# =======================================================
# 4. ФАЙЛОВАЯ СИСТЕМА И ПУТИ
# =======================================================
# Путь внутри контейнера Docker.
# Используется в App.py для раздачи статики и загрузки файлов.
UPLOAD_FOLDER=/app/server/uploads

# Путь для хранения ортофотопланов (ProfileOrthophotos.tsx загружает сюда)
ORTHO_FOLDER=/app/server/uploads/orthos

# Временная папка для обработки GDAL (конвертация в COG)
TEMP_FOLDER=/app/server/data/temp/orthos

# Папка для статусов задач (task_service.py)
TASKS_FOLDER=/app/server/data/tasks


# =======================================================
# 5. БАЗА ДАННЫХ (PostgreSQL / PostGIS)
# =======================================================
# Настройки контейнера базы данных
POSTGRES_USER=botplus_user
POSTGRES_PASSWORD=botplus_password
POSTGRES_DB=botplus_db
POSTGRES_PORT=5432

# Настройки подключения Бэкенда (через пулер PgBouncer)
DB_HOST=pgbouncer
DB_PORT=6432
DB_NAME=botplus_db
DB_USER=botplus_user
DB_PASSWORD=botplus_password

# Строка подключения для SQLAlchemy (используется в user_repository.py, models.py)
DATABASE_URL=postgresql://botplus_user:botplus_password@pgbouncer:6432/botplus_db


# =======================================================
# 6. PGBOUNCER (Пулер соединений)
# =======================================================
PGBOUNCER_PORT=6432
PGBOUNCER_AUTH_TYPE=md5


# =======================================================
# 7. OBJECT STORAGE (MinIO / S3)
# =======================================================
# Учетные данные админа MinIO
MINIO_ROOT_USER=minioadmin
MINIO_ROOT_PASSWORD=minioadmin

# Настройки для Python-клиента (storage.py)
# ProfilePanoramas.tsx получает ссылки на файлы через контроллер, который стучится сюда
MINIO_ENDPOINT=minio:9000
MINIO_ACCESS_KEY=minioadmin
MINIO_SECRET_KEY=minioadmin
MINIO_SECURE=False

# Имена бакетов (важно: совпадают с логикой в storage_service.py и pano_controller.py)
MINIO_BUCKET_NAME=panoramas
MINIO_ORTHO_BUCKET=orthophotos

# Порты для доступа снаружи (например, для проверки через браузер)
MINIO_API_PORT=9000
MINIO_CONSOLE_PORT=9001


# =======================================================
# 8. TITILER & GDAL (Карта и Тайлы)
# =======================================================
# Порт сервера тайлов (используется в MapPage.tsx через прокси бэкенда)
TITILER_PORT=8000
# Внутренний адрес для ortho_service.py
TITILER_INTERNAL_URL=http://titiler:80

# Оптимизация GDAL для скорости (критично для больших TIFF файлов)
GDAL_DISABLE_READDIR_ON_OPEN=EMPTY_DIR
CPL_VSIL_CURL_ALLOWED_EXTENSIONS=.tif,.tiff,.png,.jpg,.jpeg
# Отключение проверки SSL для MinIO внутри докера
GDAL_HTTP_UNSAFESSL=YES