```markdown
# Botplus Maps (GIS Platform)

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞: –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Ä–∞–±–æ—Ç–∞ —Å PostGIS/MinIO, API –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —Ç–∞–π–ª–æ–≤ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é.

---

## üîé –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ

**Botplus Maps** ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –Ω–∞ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —Å–ª–æ–∏, –æ—Ä—Ç–æ—Ñ–æ—Ç–æ–ø–ª–∞–Ω—ã (COG) –∏ —Å—Ñ–µ—Ä–∏—á–µ—Å–∫–∏–µ –ø–∞–Ω–æ—Ä–∞–º—ã 360¬∞.

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å—Ç–µ–∫–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Docker-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏**:
* **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: React + TypeScript (CRA), —Å—Ç–µ–π—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä **Zustand**, –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫ **Leaflet**.
* **–ë—ç–∫–µ–Ω–¥**: Flask (Python 3.12) —Å–æ —Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (**Controllers ‚Üí Managers ‚Üí Services ‚Üí Repositories**).
* **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**:
    * üêò **PostgreSQL 16 + PostGIS 3.4** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
    * üóÑÔ∏è **MinIO (S3)** ‚Äî –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–∞–Ω–æ—Ä–∞–º –∏ GeoTIFF.
    * üåç **TiTiler** ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ç–∞–π–ª–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ COG.
    * ‚ö° **PgBouncer** ‚Äî –ø—É–ª–µ—Ä —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
* üîë **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ö–∞—Å—Ç–æ–º–Ω–∞—è JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ HttpOnly cookies.
* üìê **–í–µ–∫—Ç–æ—Ä–Ω—ã–µ –∫–∞—Ä—Ç—ã**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MVT (Mapbox Vector Tiles) –Ω–∞ –ª–µ—Ç—É –∏–∑ PostGIS —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏.
* üñºÔ∏è **–ü–∞–Ω–æ—Ä–∞–º—ã 360¬∞**: –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –ø–∞—Ä—Å–∏–Ω–≥ EXIF (GPS/Heading), –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä —á–µ—Ä–µ–∑ Marzipano.
* ü¶Ö **–û—Ä—Ç–æ—Ñ–æ—Ç–æ**: –ó–∞–≥—Ä—É–∑–∫–∞ GeoTIFF, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü (GDAL) –∏ —Å—Ç—Ä–∏–º–∏–Ω–≥ —Ç–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ TiTiler.
* üöÄ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Docker Compose.

–ü—É–±–ª–∏—á–Ω—ã–π API (–≤ –ø—Ä–æ–¥–µ): `https://api.botplus.ru` (–ø—Ä–∏–º–µ—Ä).

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è



.
‚îú‚îÄ‚îÄ data/
‚îÇ   ‚îú‚îÄ‚îÄ minio_data/               # –î–∞–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç–Ω–æ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è MinIO)
‚îÇ   ‚îî‚îÄ‚îÄ pg_data/                  # –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ PostgreSQL
‚îú‚îÄ‚îÄ pgbouncer/                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É–ª–µ—Ä–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ pgbouncer.ini
‚îÇ   ‚îî‚îÄ‚îÄ userlist.txt
‚îú‚îÄ‚îÄ public/                       # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –∞—Å—Å–µ—Ç—ã —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ icons/
‚îÇ   ‚îú‚îÄ‚îÄ images/
‚îÇ   ‚îú‚îÄ‚îÄ videos/
‚îÇ   ‚îú‚îÄ‚îÄ favicon.ico
‚îÇ   ‚îú‚îÄ‚îÄ index.html
‚îÇ   ‚îî‚îÄ‚îÄ manifest.json
‚îú‚îÄ‚îÄ server/                       # Backend (Flask)
‚îÇ   ‚îú‚îÄ‚îÄ alembic/                  # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routers/              # –î–æ–ø. —Ä–æ—É—Ç—ã (FastAPI/Flask style)
‚îÇ   ‚îú‚îÄ‚îÄ controllers/              # –í—Ö–æ–¥–Ω—ã–µ —Ç–æ—á–∫–∏ API (Blueprints)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_controller.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ortho_controller.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pano_controller.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vector.py             # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ managers/                 # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Ñ–∞—Å–∞–¥—ã)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ortho_manager.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pano_manager.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # SQLModels / SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ortho.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pano.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ repositories/             # –°–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –ë–î (CRUD)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_repository.py
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # –°–µ—Ä–≤–∏—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ —É—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ uploads/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth_service.py
‚îÇ   ‚îú‚îÄ‚îÄ app.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database.py               # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ init_db.py                # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ init_pg_auth.py           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ PG
‚îÇ   ‚îú‚îÄ‚îÄ reset_pass.py             # –°–∫—Ä–∏–ø—Ç —Å–±—Ä–æ—Å–∞ –ø–∞—Ä–æ–ª–µ–π
‚îÇ   ‚îú‚îÄ‚îÄ storage.py                # –†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º–æ–π/S3
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt          # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ src/                          # Frontend (React)
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ maps/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/             # –Ø–¥—Ä–æ –∫–∞—Ä—Ç—ã (—Å–æ–±—ã—Ç–∏—è, –∫–æ–Ω—Ç—Ä–æ–ª—ã)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/            # –•—É–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è (Zustand/Context)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useMapStore.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ useUIStore.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ useVectorStore.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layers/           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ–µ–≤ (Ortho, Pano, Vector)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/               # –≠–ª–µ–º–µ–Ω—Ç—ã –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∫–∞—Ä—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ panels/       # –ë–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ viewers/      # –í—å—é–≤–µ—Ä –ø–∞–Ω–æ—Ä–∞–º
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile/              # –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfileDashboard.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfileOrthophotos.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProfilePanoramas.tsx
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ProfileVector.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Header.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Home.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ LoginPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RegisterPage.tsx
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UploadOrtho.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ UploadPano.tsx
‚îÇ   ‚îú‚îÄ‚îÄ contexts/                 # React Context (Auth)
‚îÇ   ‚îú‚îÄ‚îÄ hooks/                    # –û–±—â–∏–µ —Ö—É–∫–∏ (useAuth)
‚îÇ   ‚îú‚îÄ‚îÄ types/                    # TypeScript –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è (.d.ts)
‚îÇ   ‚îú‚îÄ‚îÄ utils/                    # –£—Ç–∏–ª–∏—Ç—ã (API wrapper)
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx
‚îÇ   ‚îú‚îÄ‚îÄ routes.tsx
‚îÇ   ‚îî‚îÄ‚îÄ setupProxy.js             # –ü—Ä–æ–∫—Å–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ .env                          # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ docker-compose.yml            # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îú‚îÄ‚îÄ Dockerfile                    # –°–±–æ—Ä–∫–∞ –æ–±—Ä–∞–∑–∞
‚îú‚îÄ‚îÄ package.json                  # JS-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ tsconfig.json                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è TS
‚îî‚îÄ‚îÄ README.md



> –í–∞–∂–Ω–æ: –≤—Å—è –ø—Ä–∏–∫–ª–∞–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞ ‚Äî –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (–≤–∞–ª–∏–¥–∞—Ü–∏—è, –ø—Ä–∞–≤–∏–ª–∞, –ø—Ä–∞–≤–∞). –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ ‚Äî —Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –≤—ã–∑–æ–≤—ã API.

---





–û—Ç–ª–∏—á–Ω–æ, –æ–±–Ω–æ–≤–ª—è–µ–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã. –ü–æ—Å–∫–æ–ª—å–∫—É –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å —Å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ SQLite –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä (PostGIS + MinIO + TiTiler), —ç—Ç–∏ —Å–µ–∫—Ü–∏–∏ —Ç—Ä–µ–±—É—é—Ç –ø–æ–ª–Ω–æ–≥–æ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è.

–í–æ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è `README.md`, –æ—Ö–≤–∞—Ç—ã–≤–∞—é—â–∏–π –Ω–æ–≤—É—é —Å—Ö–µ–º—É –ë–î, —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –≥–∏–±—Ä–∏–¥–Ω—ã–π –∑–∞–ø—É—Å–∫.

---

## üß∞ –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **PostgreSQL 16** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º **PostGIS 3.4**.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (Auth)
-- –°–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏: init_pg_auth.py
CREATE TABLE IF NOT EXISTS users (
    id         SERIAL PRIMARY KEY,
    username   VARCHAR(50) UNIQUE NOT NULL,
    password   VARCHAR(255) NOT NULL, -- Scrypt/PBKDF2 —Ö–µ—à
    created_at TIMESTAMP DEFAULT NOW()
);

-- –ü–∞–Ω–æ—Ä–∞–º—ã (GIS Data)
-- –¢–∞–±–ª–∏—Ü–∞ 'photos_4326' –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π
CREATE TABLE IF NOT EXISTS public.photos_4326 (
    id          SERIAL PRIMARY KEY,
    geom        GEOMETRY(Point, 4326), -- PostGIS —Ç–æ—á–∫–∞ (lon, lat)
    filename    TEXT,                  -- –ò–º—è —Ñ–∞–π–ª–∞ –≤ MinIO
    path        TEXT,                  -- –ü–æ–ª–Ω—ã–π –ø—É—Ç—å
    directory   TEXT,
    timestamp   TIMESTAMP,             -- EXIF Date
    altitude    FLOAT,                 -- –í—ã—Å–æ—Ç–∞ –Ω–∞–¥ —É—Ä–æ–≤–Ω–µ–º –º–æ—Ä—è
    direction   FLOAT,                 -- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã (Heading)
    rotation    FLOAT,                 -- Roll
    "order"     INTEGER
);

-- –û—Ä—Ç–æ—Ñ–æ—Ç–æ–ø–ª–∞–Ω—ã (Raster Metadata)
CREATE TABLE IF NOT EXISTS orthophotos (
    id          SERIAL PRIMARY KEY,
    filename    TEXT NOT NULL,         -- –ò–º—è —Ñ–∞–π–ª–∞ –≤ MinIO (bucket: orthophotos)
    bounds      TEXT,                  -- JSON {north, south, east, west}
    url         TEXT,                  -- –°—Å—ã–ª–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

```

> **–í–∞–∂–Ω–æ:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º `server/init_pg_auth.py`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: `admin` / `admin`.

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `docker-compose.yml` –∏ `config.py`.

### Backend (Flask)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (Docker) |
| --- | --- | --- |
| `DATABASE_URL` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PG (–æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ PgBouncer) | `postgresql://botplus_user:botplus_password@pgbouncer:6432/botplus_db` |
| `MINIO_ENDPOINT` | –•–æ—Å—Ç S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞ | `minio:9000` |
| `MINIO_ACCESS_KEY` | –õ–æ–≥–∏–Ω S3 | `minioadmin` |
| `MINIO_SECRET_KEY` | –ü–∞—Ä–æ–ª—å S3 | `minioadmin` |
| `MINIO_SECURE` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ HTTPS –¥–ª—è S3 | `False` |
| `JWT_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤ | `change-me` |
| `UPLOAD_FOLDER` | –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫ | `/app/server/uploads` |

### Frontend (Build time)

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ API.

* **Local Development**: –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `src/setupProxy.js` –Ω–∞ `:5000`.
* **Production**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ (`/api/...`).

### TiTiler (GeoTIFF Server)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ |
| --- | --- |
| `AWS_S3_ENDPOINT` | –£–∫–∞–∑—ã–≤–∞–µ—Ç GDAL —Ö–æ–¥–∏—Ç—å –≤ –Ω–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π MinIO (`minio:9000`) |
| `AWS_HTTPS` | `FALSE` (–æ—Ç–∫–ª—é—á–∞–µ—Ç SSL handshake –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞) |
| `AWS_VIRTUAL_HOSTING` | `FALSE` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç path-style access `host/bucket/file`) |

---

## üßë‚Äçüíª –ó–∞–ø—É—Å–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º)

–¢–∞–∫ –∫–∞–∫ –ø–æ–¥–Ω—è—Ç—å PostGIS –∏ MinIO –ª–æ–∫–∞–ª—å–Ω–æ "—Ä—É–∫–∞–º–∏" —Å–ª–æ–∂–Ω–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ Docker**, –∞ **–ö–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ**.

### –®–∞–≥ 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

```bash
docker compose up -d db minio pgbouncer titiler

```

*–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã `5432`, `9000`, `9001`, `6432` —Å–≤–æ–±–æ–¥–Ω—ã.*

### –®–∞–≥ 2: Backend (Python)

```bash
cd server
python3 -m venv .venv
source .venv/bin/activate  # (Windows: .venv\Scripts\activate)

# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ENV –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º Docker-—Ö–æ—Å—Ç—ã –Ω–∞ localhost)
export DATABASE_URL="postgresql://botplus_user:botplus_password@localhost:6432/botplus_db"
export MINIO_ENDPOINT="localhost:9000"
export MINIO_SECURE="False"
export UPLOAD_FOLDER="./uploads"  # –°–æ–∑–¥–∞–π—Ç–µ —ç—Ç—É –ø–∞–ø–∫—É

# 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î (–µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Ä–∞–∑)
python init_pg_auth.py

# 4. –ó–∞–ø—É—Å–∫
python app.py

```

*–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://127.0.0.1:5000`.*

### –®–∞–≥ 3: Frontend (React)

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
npm install
npm start

```

*–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`. –ë–ª–∞–≥–æ–¥–∞—Ä—è `setupProxy.js`, –∑–∞–ø—Ä–æ—Å—ã `/api` –±—É–¥—É—Ç —É–ª–µ—Ç–∞—Ç—å –Ω–∞ –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π Python-—Å–µ—Ä–≤–µ—Ä.*






–ü—Ä–æ–¥–æ–ª–∂–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ. –°–ª–µ–¥—É—é—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã (Docker, Production, API, Frontend) –∫–∞—Ä–¥–∏–Ω–∞–ª—å–Ω–æ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –∏–∑-–∑–∞ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ (MinIO, PostGIS, TiTiler).

–°–∫–æ–ø–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç –±–ª–æ–∫ –∏ –≤—Å—Ç–∞–≤—å—Ç–µ –µ–≥–æ **–ø–æ—Å–ª–µ** —Ä–∞–∑–¥–µ–ª–∞ "–ó–∞–ø—É—Å–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ":

---

## üê≥ –ó–∞–ø—É—Å–∫ –≤ Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ–∂–Ω—É—é –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é –∏–∑ 5 —Å–µ—Ä–≤–∏—Å–æ–≤. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `docker run` –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è.

### Docker Compose

```bash
# 1. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker compose up -d --build

# 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (—á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å)
docker compose logs -f app

```

**–°–µ—Ä–≤–∏—Å—ã –≤ —Å—Ç–µ–∫–µ:**

1. **`app`** (:5580) ‚Äî –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Flask + React Static).
2. **`db`** (:5432) ‚Äî PostgreSQL 16 + PostGIS 3.4.
3. **`minio`** (:9000, :9001) ‚Äî S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤.
4. **`pgbouncer`** (:6432) ‚Äî –ü—É–ª–µ—Ä —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –ë–î.
5. **`titiler`** (:8000) ‚Äî –°–µ—Ä–≤–µ—Ä —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ GeoTIFF (COG).

> **Healthcheck:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç `init_pg_auth.py` –º–æ–∂–µ—Ç –∂–¥–∞—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ë–î –¥–æ 30 —Å–µ–∫—É–Ω–¥.

---

## üöÄ –ü—Ä–æ–¥–∞–∫—à–Ω (Deploy)

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `app` —É–∂–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Gunicorn** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **Gevent** (—Å–º. `docker-compose.yml` -> `command`).
–í–∞–º –Ω—É–∂–Ω–æ –ª–∏—à—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **Nginx** –∫–∞–∫ —Ä–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ–¥ Docker-–ø–æ—Ä—Ç–æ–º `5580`.

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx (`/etc/nginx/sites-available/botplus`):**

```nginx
server {
    server_name maps.yourdomain.com;

    # –õ–∏–º–∏—Ç –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –±–æ–ª—å—à–∏—Ö GeoTIFF/–ü–∞–Ω–æ—Ä–∞–º
    client_max_body_size 500M;

    location / {
        # –ü—Ä–æ–∫—Å–∏—Ä—É–µ–º –Ω–∞ –ø–æ—Ä—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (5580)
        proxy_pass http://127.0.0.1:5580;
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–æ–ª–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤)
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
    
    # (–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) SSL —á–µ—Ä–µ–∑ Certbot
    # listen 443 ssl...
}

```

---

## üß≠ API (–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫)

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `/api`.

### üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Custom JWT)

*–¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ HttpOnly Cookie.*

* `POST /api/auth/login` ‚Äî –í—Ö–æ–¥ `{username, password}`.
* `GET /api/auth/me` ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{authenticated: true, user: {...}}`.
* `POST /api/auth/logout` ‚Äî –û—á–∏—Å—Ç–∫–∞ –∫—É–∫–∏.

### üìê –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (PostGIS)

* `GET /api/vector/databases` ‚Äî –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –±–∞–∑.
* `GET /api/vector/layers/{db_name}` ‚Äî –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü —Å –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π.
* `GET /api/vector/tiles/combined/{db}/{z}/{x}/{y}.pbf` ‚Äî **MVT –¢–∞–π–ª—ã**. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Mapbox Vector Tiles –∏–∑ PostGIS.
* `GET /api/vector/styles/{db}/{schema}/{table}` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π —Å–ª–æ—è (Single/Categorized).

### üì∑ –ü–∞–Ω–æ—Ä–∞–º—ã 360¬∞

* `GET /api/panoramas` ‚Äî –°–ø–∏—Å–æ–∫ –ø–∞–Ω–æ—Ä–∞–º (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç BBOX —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é).
* `POST /api/upload` ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ (Multipart). –ò–∑–≤–ª–µ–∫–∞–µ—Ç EXIF, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ MinIO + PostGIS.

### ü¶Ö –û—Ä—Ç–æ—Ñ–æ—Ç–æ–ø–ª–∞–Ω—ã

* `GET /api/orthophotos` ‚Äî –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç.
* `POST /api/upload_ortho` ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ GeoTIFF. –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MinIO, –≥—Ä–∞–Ω–∏—Ü—ã –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ GDAL.

---

## üñ•Ô∏è –§—Ä–æ–Ω—Ç–µ–Ω–¥ (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `src/components/maps` –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–æ–¥—É–ª—å–Ω–∞—è:

* **State Management (Zustand)**:
* `useMapStore.ts` ‚Äî –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å—Ç—Ä–æ–≤—ã—Ö —Å–ª–æ–µ–≤ (–û—Ä—Ç–æ).
* `useVectorStore.ts` ‚Äî –ö—ç—à –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∏–ª–µ–π.
* `useUIStore.ts` ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª—è–º–∏ (Layers, Pano, Vector).


* **–°–ª–æ–∏ (`layers/`)**:
* `VectorLayerRenderer` ‚Äî –£–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ MVT —á–µ—Ä–µ–∑ `leaflet.vectorgrid`.
* `OrthoLayer` ‚Äî –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ TiTiler.
* `PanoLayer` ‚Äî –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤.


* **Core**:
* `CustomZoomControl` ‚Äî –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∑—É–º–∞.
* `MapEvents` ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é.



---

## üßØ Troubleshooting

### 1. –û—à–∏–±–∫–∞ "MinIO Connection Refused"

–ï—Å–ª–∏ TiTiler –∏–ª–∏ Backend –Ω–µ –≤–∏–¥—è—Ç MinIO:

* –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ (docker network).
* –í `docker-compose.yml` –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `MINIO_ENDPOINT` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `minio:9000`, –∞ –Ω–µ localhost).

### 2. –ù–µ –≥—Ä—É–∑—è—Ç—Å—è —Ç–∞–π–ª—ã –∫–∞—Ä—Ç—ã (404/500)

* **Vector**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ PostGIS –µ—Å—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—è –∏ SRID=4326. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `app` –Ω–∞ –æ—à–∏–±–∫–∏ SQL.
* **Ortho**: –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (Network). –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –æ—Ç TiTiler, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `titiler`. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –Ω–µ –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –∏–∑ MinIO –∏–∑-–∑–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–µ–≥–∏–æ–Ω–∞/–±–∞–∫–µ—Ç–∞.

### 3. "Index.html not found"

* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker-–æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. Frontend –±–∏–ª–¥–∏—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ `FROM node:22-alpine AS ui`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø–∞–ø–∫–∏ `/app/public/build` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

---

## üß™ –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# üî• –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (—Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π)
docker compose down
docker compose up -d --build

# üìú –ß—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –±—ç–∫–µ–Ω–¥–∞
docker compose logs -f app

# üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–º–æ–≤!)
docker compose down -v

```

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

¬© Botplus Maps. Enterprise GIS Solution.


































































–í–æ—Ç –ø–æ–ª–Ω—ã–π, –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `README.md`, —Å–æ–±—Ä–∞–Ω–Ω—ã–π –≤ –µ–¥–∏–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç. –û–Ω —É—á–∏—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (PostGIS, MinIO, TiTiler, Microservices), –∫–æ—Ç–æ—Ä—ã–µ –º—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∏ –≤ –≤–∞—à–∏—Ö —Ñ–∞–π–ª–∞—Ö.

```markdown
# Botplus Maps (Enterprise GIS Platform)

–ü–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞: –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞, —Ä–∞–±–æ—Ç–∞ —Å PostGIS/MinIO, API –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö —Ç–∞–π–ª–æ–≤ –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é.

---

## üîé –ß—Ç–æ —ç—Ç–æ —Ç–∞–∫–æ–µ

**Botplus Maps** ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤–µ–±-–ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≥–µ–æ–ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏. –°–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –Ω–∞ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–µ –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —Å–ª–æ–∏, –æ—Ä—Ç–æ—Ñ–æ—Ç–æ–ø–ª–∞–Ω—ã (COG) –∏ —Å—Ñ–µ—Ä–∏—á–µ—Å–∫–∏–µ –ø–∞–Ω–æ—Ä–∞–º—ã 360¬∞.

–ü—Ä–æ–µ–∫—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º —Å—Ç–µ–∫–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º **Docker-–æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏–∏**:
* **–§—Ä–æ–Ω—Ç–µ–Ω–¥**: React + TypeScript (CRA), —Å—Ç–µ–π—Ç-–º–µ–Ω–µ–¥–∂–µ—Ä **Zustand**, –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π –¥–≤–∏–∂–æ–∫ **Leaflet**.
* **–ë—ç–∫–µ–Ω–¥**: Flask (Python 3.12) —Å–æ —Å–ª–æ–∏—Å—Ç–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π (**Controllers ‚Üí Managers ‚Üí Services ‚Üí Repositories**).
* **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö**:
    * üêò **PostgreSQL 16 + PostGIS 3.4** ‚Äî —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤–µ–∫—Ç–æ—Ä–Ω–æ–π –≥–µ–æ–º–µ—Ç—Ä–∏–∏ –∏ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö.
    * üóÑÔ∏è **MinIO (S3)** ‚Äî –æ–±—ä–µ–∫—Ç–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è –ø–∞–Ω–æ—Ä–∞–º –∏ GeoTIFF.
    * üåç **TiTiler** ‚Äî –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ç–∞–π–ª–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ COG (Cloud Optimized GeoTIFF).
    * ‚ö° **PgBouncer** ‚Äî –ø—É–ª–µ—Ä —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –≤—ã—Å–æ–∫–æ–π –Ω–∞–≥—Ä—É–∑–∫–∏.

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
* üîë **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ö–∞—Å—Ç–æ–º–Ω–∞—è JWT-–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ HttpOnly cookies.
* üìê **–í–µ–∫—Ç–æ—Ä–Ω—ã–µ –∫–∞—Ä—Ç—ã**: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MVT (Mapbox Vector Tiles) –Ω–∞ –ª–µ—Ç—É –∏–∑ PostGIS —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏ (Simple/Categorized).
* üñºÔ∏è **–ü–∞–Ω–æ—Ä–∞–º—ã 360¬∞**: –ú–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞, –ø–∞—Ä—Å–∏–Ω–≥ EXIF (GPS/Heading), –∫–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤ –Ω–∞ –∫–∞—Ä—Ç–µ, –ø—Ä–æ—Å–º–æ—Ç—Ä —á–µ—Ä–µ–∑ Marzipano.
* ü¶Ö **–û—Ä—Ç–æ—Ñ–æ—Ç–æ**: –ó–∞–≥—Ä—É–∑–∫–∞ GeoTIFF, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≥—Ä–∞–Ω–∏—Ü (GDAL) –∏ —Å—Ç—Ä–∏–º–∏–Ω–≥ —Ç–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ TiTiler.
* üöÄ **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ Docker Compose.

–ü—É–±–ª–∏—á–Ω—ã–π API (–≤ –ø—Ä–æ–¥–µ): `https://api.botplus.ru` (–ø—Ä–∏–º–µ—Ä).

---

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```text
.
‚îú‚îÄ‚îÄ data/                         # Persisted Data (Docker volumes)
‚îÇ   ‚îú‚îÄ‚îÄ minio_data/               # –î–∞–Ω–Ω—ã–µ S3 (–ø–∞–Ω–æ—Ä–∞–º—ã, –æ—Ä—Ç–æ—Ñ–æ—Ç–æ)
‚îÇ   ‚îî‚îÄ‚îÄ pg_data/                  # –§–∞–π–ª—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö PostgreSQL
‚îú‚îÄ‚îÄ pgbouncer/                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—É–ª–µ—Ä–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ pgbouncer.ini
‚îÇ   ‚îî‚îÄ‚îÄ userlist.txt
‚îú‚îÄ‚îÄ server/                       # Backend (Flask Application)
‚îÇ   ‚îú‚îÄ‚îÄ alembic/                  # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ routers/              # –î–æ–ø. —Ä–æ—É—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ controllers/              # API Endpoints (Blueprints)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth_controller.py    # –õ–æ–≥–∏–Ω/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è/Me
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ortho_controller.py   # –û—Ä—Ç–æ—Ñ–æ—Ç–æ–ø–ª–∞–Ω—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pano_controller.py    # –ü–∞–Ω–æ—Ä–∞–º—ã 360
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vector.py             # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è MVT —Ç–∞–π–ª–æ–≤ –∏–∑ PostGIS
‚îÇ   ‚îú‚îÄ‚îÄ managers/                 # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (Orchestration)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ortho_manager.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pano_manager.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_manager.py
‚îÇ   ‚îú‚îÄ‚îÄ models/                   # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ortho.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pano.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user.py
‚îÇ   ‚îú‚îÄ‚îÄ repositories/             # –°–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –ë–î (SQL/CRUD)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ user_repository.py
‚îÇ   ‚îú‚îÄ‚îÄ services/                 # –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ auth_service.py       # JWT Logic
‚îÇ   ‚îú‚îÄ‚îÄ app.py                    # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Flask & Serve Static
‚îÇ   ‚îú‚îÄ‚îÄ config.py                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (ENV vars)
‚îÇ   ‚îú‚îÄ‚îÄ database.py               # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î (—á–µ—Ä–µ–∑ PgBouncer)
‚îÇ   ‚îú‚îÄ‚îÄ init_pg_auth.py           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ö–µ–º—ã –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ storage.py                # Wrapper –¥–ª—è MinIO –∏ LocalStorage
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt          # Python-–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ src/                          # Frontend (React + TypeScript)
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ maps/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ core/             # –Ø–¥—Ä–æ –∫–∞—Ä—Ç—ã (Zoom, Events)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ hooks/            # Zustand Stores (Map, UI, Vector)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layers/           # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–æ–µ–≤ (Ortho, Pano, VectorTile)
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ui/               # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞—Ä—Ç—ã
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ panels/       # –ë–æ–∫–æ–≤—ã–µ –ø–∞–Ω–µ–ª–∏
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ viewers/      # PanoramaViewer (Marzipano)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile/              # –õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç (Dashboard)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ   ‚îú‚îÄ‚îÄ contexts/                 # React Context (Auth)
‚îÇ   ‚îú‚îÄ‚îÄ utils/                    # API wrappers (axios/fetch)
‚îÇ   ‚îú‚îÄ‚îÄ App.tsx                   # –†–æ—É—Ç–∏–Ω–≥
‚îÇ   ‚îî‚îÄ‚îÄ setupProxy.js             # –ü—Ä–æ–∫—Å–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ .env                          # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–µ –≤ git)
‚îú‚îÄ‚îÄ docker-compose.yml            # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
‚îî‚îÄ‚îÄ Dockerfile                    # Multi-stage —Å–±–æ—Ä–∫–∞

```

> **–í–∞–∂–Ω–æ:** –í—Å—è –ø—Ä–∏–∫–ª–∞–¥–Ω–∞—è –ª–æ–≥–∏–∫–∞ ‚Äî –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ. –§—Ä–æ–Ω—Ç–µ–Ω–¥ –æ—Ç–≤–µ—á–∞–µ—Ç —Ç–æ–ª—å–∫–æ –∑–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –≤—ã–∑–æ–≤—ã API.

---

## üß∞ –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **PostgreSQL 16** —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º **PostGIS 3.4**.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã

```sql
-- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ (Auth)
-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: server/init_pg_auth.py
CREATE TABLE IF NOT EXISTS users (
    id         SERIAL PRIMARY KEY,
    username   VARCHAR(50) UNIQUE NOT NULL,
    password   VARCHAR(255) NOT NULL, -- Scrypt/PBKDF2 —Ö–µ—à
    created_at TIMESTAMP DEFAULT NOW()
);

-- –ü–∞–Ω–æ—Ä–∞–º—ã (GIS Data)
-- –¢–∞–±–ª–∏—Ü–∞ 'photos_4326' —Ö—Ä–∞–Ω–∏—Ç –≥–µ–æ–º–µ—Ç—Ä–∏—é Point(lon, lat)
CREATE TABLE IF NOT EXISTS public.photos_4326 (
    id          SERIAL PRIMARY KEY,
    geom        GEOMETRY(Point, 4326), -- PostGIS Geometry
    filename    TEXT,                  -- –ò–º—è —Ñ–∞–π–ª–∞ –≤ MinIO
    path        TEXT,
    directory   TEXT,
    timestamp   TIMESTAMP,             -- EXIF Date
    altitude    FLOAT,                 -- –í—ã—Å–æ—Ç–∞ –Ω–∞–¥ —É—Ä–æ–≤–Ω–µ–º –º–æ—Ä—è
    direction   FLOAT,                 -- –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞–º–µ—Ä—ã (Heading)
    rotation    FLOAT,                 -- Roll
    "order"     INTEGER
);

-- –û—Ä—Ç–æ—Ñ–æ—Ç–æ–ø–ª–∞–Ω—ã (Raster Metadata)
CREATE TABLE IF NOT EXISTS orthophotos (
    id          SERIAL PRIMARY KEY,
    filename    TEXT NOT NULL,         -- –ò–º—è —Ñ–∞–π–ª–∞ –≤ MinIO (bucket: orthophotos)
    bounds      TEXT,                  -- JSON {north, south, east, west}
    url         TEXT,                  -- –°—Å—ã–ª–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
    upload_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

```

> **–í–∞–∂–Ω–æ:** –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å–∫—Ä–∏–ø—Ç–æ–º `server/init_pg_auth.py`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞: `admin` / `admin`.

---

## ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `docker-compose.yml` –∏ `config.py`.

### Backend (Flask)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (Docker) |
| --- | --- | --- |
| `DATABASE_URL` | –°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PG (–æ–±—ã—á–Ω–æ —á–µ—Ä–µ–∑ PgBouncer) | `postgresql://botplus_user:botplus_password@pgbouncer:6432/botplus_db` |
| `MINIO_ENDPOINT` | –•–æ—Å—Ç S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞ | `minio:9000` |
| `MINIO_ACCESS_KEY` | –õ–æ–≥–∏–Ω S3 | `minioadmin` |
| `MINIO_SECRET_KEY` | –ü–∞—Ä–æ–ª—å S3 | `minioadmin` |
| `MINIO_SECURE` | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ HTTPS –¥–ª—è S3 | `False` |
| `JWT_SECRET` | –°–µ–∫—Ä–µ—Ç –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ —Ç–æ–∫–µ–Ω–æ–≤ | `change-me` |
| `UPLOAD_FOLDER` | –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞ –¥–ª—è –∑–∞–≥—Ä—É–∑–æ–∫ | `/app/server/uploads` |

### Frontend (Build time)

–ü—Ä–æ–µ–∫—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ API.

* **Local Development**: –ó–∞–ø—Ä–æ—Å—ã –ø—Ä–æ–∫—Å–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `src/setupProxy.js` –Ω–∞ `:5000`.
* **Production**: –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ (`/api/...`).

### TiTiler (GeoTIFF Server)

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ó–∞—á–µ–º –Ω—É–∂–Ω–∞ |
| --- | --- |
| `AWS_S3_ENDPOINT` | –£–∫–∞–∑—ã–≤–∞–µ—Ç GDAL —Ö–æ–¥–∏—Ç—å –≤ –Ω–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π MinIO (`minio:9000`) |
| `AWS_HTTPS` | `FALSE` (–æ—Ç–∫–ª—é—á–∞–µ—Ç SSL handshake –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞) |
| `AWS_VIRTUAL_HOSTING` | `FALSE` (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç path-style access `host/bucket/file`) |

---

## üê≥ –ó–∞–ø—É—Å–∫ –≤ Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ª–æ–∂–Ω—É—é –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—é –∏–∑ 5 —Å–µ—Ä–≤–∏—Å–æ–≤. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `docker run` –Ω–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è.

### Docker Compose

```bash
# 1. –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker compose up -d --build

# 2. –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ (—á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ë–î –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–ª–∞—Å—å)
docker compose logs -f app

```

**–°–µ—Ä–≤–∏—Å—ã –≤ —Å—Ç–µ–∫–µ:**

1. **`app`** (:5580) ‚Äî –û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (Flask + React Static).
2. **`db`** (:5432) ‚Äî PostgreSQL 16 + PostGIS 3.4.
3. **`minio`** (:9000, :9001) ‚Äî S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ñ–∞–π–ª–æ–≤.
4. **`pgbouncer`** (:6432) ‚Äî –ü—É–ª–µ—Ä —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –¥–ª—è –ë–î.
5. **`titiler`** (:8000) ‚Äî –°–µ—Ä–≤–µ—Ä —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ GeoTIFF (COG).

> **Healthcheck:** –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ —Å–∫—Ä–∏–ø—Ç `init_pg_auth.py` –º–æ–∂–µ—Ç –∂–¥–∞—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –ë–î –¥–æ 30 —Å–µ–∫—É–Ω–¥.

---

## üßë‚Äçüíª –ó–∞–ø—É—Å–∫ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ (–ì–∏–±—Ä–∏–¥–Ω—ã–π —Ä–µ–∂–∏–º)

–¢–∞–∫ –∫–∞–∫ –ø–æ–¥–Ω—è—Ç—å PostGIS –∏ MinIO –ª–æ–∫–∞–ª—å–Ω–æ "—Ä—É–∫–∞–º–∏" —Å–ª–æ–∂–Ω–æ, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥: **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≤ Docker**, –∞ **–ö–æ–¥ –ª–æ–∫–∞–ª—å–Ω–æ**.

### –®–∞–≥ 1: –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–æ–ª—å–∫–æ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã:

```bash
docker compose up -d db minio pgbouncer titiler

```

*–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã `5432`, `9000`, `9001`, `6432` —Å–≤–æ–±–æ–¥–Ω—ã.*

### –®–∞–≥ 2: Backend (Python)

```bash
cd server
python3 -m venv .venv
source .venv/bin/activate  # (Windows: .venv\Scripts\activate)

# 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ ENV –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ (–ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º Docker-—Ö–æ—Å—Ç—ã –Ω–∞ localhost)
export DATABASE_URL="postgresql://botplus_user:botplus_password@localhost:6432/botplus_db"
export MINIO_ENDPOINT="localhost:9000"
export MINIO_SECURE="False"
export UPLOAD_FOLDER="./uploads"  # –°–æ–∑–¥–∞–π—Ç–µ —ç—Ç—É –ø–∞–ø–∫—É

# 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î (–µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π —Ä–∞–∑)
python init_pg_auth.py

# 4. –ó–∞–ø—É—Å–∫
python app.py

```

*–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://127.0.0.1:5000`.*

### –®–∞–≥ 3: Frontend (React)

```bash
# –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
npm install
npm start

```

*–§—Ä–æ–Ω—Ç–µ–Ω–¥ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:3000`. –ë–ª–∞–≥–æ–¥–∞—Ä—è `setupProxy.js`, –∑–∞–ø—Ä–æ—Å—ã `/api` –±—É–¥—É—Ç —É–ª–µ—Ç–∞—Ç—å –Ω–∞ –≤–∞—à –ª–æ–∫–∞–ª—å–Ω—ã–π Python-—Å–µ—Ä–≤–µ—Ä.*

---

## üöÄ –ü—Ä–æ–¥–∞–∫—à–Ω (Deploy)

–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä `app` —É–∂–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ **Gunicorn** —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π **Gevent** (—Å–º. `docker-compose.yml` -> `command`).
–í–∞–º –Ω—É–∂–Ω–æ –ª–∏—à—å –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **Nginx** –∫–∞–∫ —Ä–µ–≤–µ—Ä—Å-–ø—Ä–æ–∫—Å–∏ –ø–µ—Ä–µ–¥ Docker-–ø–æ—Ä—Ç–æ–º `5580`.

**–ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Nginx (`/etc/nginx/sites-available/botplus`):**

```nginx
server {
    server_name maps.yourdomain.com;

    # –õ–∏–º–∏—Ç –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É –±–æ–ª—å—à–∏—Ö GeoTIFF/–ü–∞–Ω–æ—Ä–∞–º
    client_max_body_size 500M;

    location / {
        # –ü—Ä–æ–∫—Å–∏—Ä—É–µ–º –Ω–∞ –ø–æ—Ä—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (5580)
        proxy_pass [http://127.0.0.1:5580](http://127.0.0.1:5580);
        
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # –î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–æ–ª–≥–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤)
        proxy_read_timeout 300s;
        proxy_connect_timeout 300s;
    }
}

```

---

## üß≠ API (–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫)

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –∏–º–µ—é—Ç –ø—Ä–µ—Ñ–∏–∫—Å `/api`.

### üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (Custom JWT)

*–¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ HttpOnly Cookie.*

* `POST /api/auth/login` ‚Äî –í—Ö–æ–¥ `{username, password}`.
* `GET /api/auth/me` ‚Äî –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Å—Å–∏–∏. –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `{authenticated: true, user: {...}}`.
* `POST /api/auth/logout` ‚Äî –û—á–∏—Å—Ç–∫–∞ –∫—É–∫–∏.

### üìê –í–µ–∫—Ç–æ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (PostGIS)

* `GET /api/vector/databases` ‚Äî –°–ø–∏—Å–æ–∫ –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –±–∞–∑.
* `GET /api/vector/layers/{db_name}` ‚Äî –°–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü —Å –≥–µ–æ–º–µ—Ç—Ä–∏–µ–π.
* `GET /api/vector/tiles/combined/{db}/{z}/{x}/{y}.pbf` ‚Äî **MVT –¢–∞–π–ª—ã**. –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è Mapbox Vector Tiles –∏–∑ PostGIS.
* `GET /api/vector/styles/{db}/{schema}/{table}` ‚Äî –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∏–ª–µ–π —Å–ª–æ—è (Single/Categorized).

### üì∑ –ü–∞–Ω–æ—Ä–∞–º—ã 360¬∞

* `GET /api/panoramas` ‚Äî –°–ø–∏—Å–æ–∫ –ø–∞–Ω–æ—Ä–∞–º (–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç BBOX —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é).
* `POST /api/upload` ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ (Multipart). –ò–∑–≤–ª–µ–∫–∞–µ—Ç EXIF, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –≤ MinIO + PostGIS.

### ü¶Ö –û—Ä—Ç–æ—Ñ–æ—Ç–æ–ø–ª–∞–Ω—ã

* `GET /api/orthophotos` ‚Äî –°–ø–∏—Å–æ–∫ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∫–∞—Ä—Ç.
* `POST /api/upload_ortho` ‚Äî –ó–∞–≥—Ä—É–∑–∫–∞ GeoTIFF. –§–∞–π–ª —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ MinIO, –≥—Ä–∞–Ω–∏—Ü—ã –≤—ã—á–∏—Å–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ GDAL.

---

## üñ•Ô∏è –§—Ä–æ–Ω—Ç–µ–Ω–¥ (–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ `src/components/maps` –ø–æ–ª–Ω–æ—Å—Ç—å—é –º–æ–¥—É–ª—å–Ω–∞—è:

* **State Management (Zustand)**:
* `useMapStore.ts` ‚Äî –°–æ—Å—Ç–æ—è–Ω–∏–µ —Ä–∞—Å—Ç—Ä–æ–≤—ã—Ö —Å–ª–æ–µ–≤ (–û—Ä—Ç–æ).
* `useVectorStore.ts` ‚Äî –ö—ç—à –≤–µ–∫—Ç–æ—Ä–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ —Å—Ç–∏–ª–µ–π.
* `useUIStore.ts` ‚Äî –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª—è–º–∏ (Layers, Pano, Vector).


* **–°–ª–æ–∏ (`layers/`)**:
* `VectorLayerRenderer` ‚Äî –£–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥ MVT —á–µ—Ä–µ–∑ `leaflet.vectorgrid`.
* `OrthoLayer` ‚Äî –§–æ—Ä–º–∏—Ä—É–µ—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ TiTiler.
* `PanoLayer` ‚Äî –ö–ª–∞—Å—Ç–µ—Ä–∏–∑–∞—Ü–∏—è –º–∞—Ä–∫–µ—Ä–æ–≤.


* **Core**:
* `CustomZoomControl` ‚Äî –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∑—É–º–∞.
* `MapEvents` ‚Äî –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–∫–æ–≤ –∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–≥–æ –º–µ–Ω—é.



---

## üßØ Troubleshooting

### 1. –û—à–∏–±–∫–∞ "MinIO Connection Refused"

–ï—Å–ª–∏ TiTiler –∏–ª–∏ Backend –Ω–µ –≤–∏–¥—è—Ç MinIO:

* –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ (docker network).
* –í `docker-compose.yml` –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `MINIO_ENDPOINT` (–¥–æ–ª–∂–Ω–æ –±—ã—Ç—å `minio:9000`, –∞ –Ω–µ localhost).

### 2. –ù–µ –≥—Ä—É–∑—è—Ç—Å—è —Ç–∞–π–ª—ã –∫–∞—Ä—Ç—ã (404/500)

* **Vector**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ PostGIS –µ—Å—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—è –∏ SRID=4326. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ `app` –Ω–∞ –æ—à–∏–±–∫–∏ SQL.
* **Ortho**: –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (Network). –ï—Å–ª–∏ –æ—à–∏–±–∫–∞ –æ—Ç TiTiler, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `titiler`. –í–æ–∑–º–æ–∂–Ω–æ, –æ–Ω –Ω–µ –º–æ–∂–µ—Ç —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –∏–∑ MinIO –∏–∑-–∑–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ —Ä–µ–≥–∏–æ–Ω–∞/–±–∞–∫–µ—Ç–∞.

### 3. "Index.html not found"

* –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker-–æ–±—Ä–∞–∑ —Å–æ–±—Ä–∞–ª—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. Frontend –±–∏–ª–¥–∏—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ `FROM node:22-alpine AS ui`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –ø–∞–ø–∫–∏ `/app/public/build` –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.

---

## üß™ –ë—ã—Å—Ç—Ä—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# üî• –ü–æ–ª–Ω—ã–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ (—Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π)
docker compose down
docker compose up -d --build

# üìú –ß—Ç–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –±—ç–∫–µ–Ω–¥–∞
docker compose logs -f app

# üóëÔ∏è –û—á–∏—Å—Ç–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (–£–¥–∞–ª–µ–Ω–∏–µ —Ç–æ–º–æ–≤!)
docker compose down -v

```

---

## üìú –õ–∏—Ü–µ–Ω–∑–∏—è

¬© Botplus Maps. Enterprise GIS Solution.

```

```